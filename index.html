<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <script src="js/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="js/morris/morris.min.js"></script>

    <title>Clean Blog</title>
<link rel="stylesheet" type="text/css" media="screen,projection" href="css/style.css">

<script>
// solr query for chyart:
// http://ectbeta.princeton.edu:8983/solr/collection1/select?q=headline%3Adowning&group=true&group.field=yearmo&&wt=json&indent=true
jQuery( document ).ready(function() {

	function goGetData(searchstr) {
		searchstr = "headline:"+searchstr;
		$.ajax({
		  'url': 'http://ectbeta.princeton.edu:8983/solr/collection1/select',
		  'data': {'wt':'json', 'q': searchstr, 'rows':50},
		  'success': handleResults,
		  'dataType': 'jsonp',
		  'jsonp': 'json.wrf'
		});
	}

	function goGetChartData(searchstr) {
		searchstr = "headline:"+searchstr;
		$.ajax({
		  'url': 'http://ectbeta.princeton.edu:8983/solr/collection1/select',
		  'data': {'wt':'json', 'q': searchstr, 'rows':50, 'group': 'true', 'group.field': 'yearmo'},
		  'success': buildChart,
		  'dataType': 'jsonp',
		  'jsonp': 'json.wrf'
		});
	}

	$( ".textinput" ).keyup(function(event) {
	  var s = this.value;
	  event.preventDefault();
	  goGetData(s);
	  goGetChartData(s);
	});


	goGetData('Georgia');
	goGetChartData('Georgia');
});


function handleResults(data) {

  var dateArr = new Array;
  $('#results').html('');
  $.each(data.response.docs, function(index, doc){
    $('#results').append("<li>"+doc.headline+" polarity: "+doc.polarity+" subjectivity: "+doc.subjectivity+" </li>");
    var dateInfo = {'year': doc.year, 'month': doc.month}
    dateArr.push(dateInfo); 
  });

  //console.log(dateArr);
}

var dArr = [];

function buildChart(data) {
  var groups = data.grouped;
  $.each(groups.yearmo.groups, function(index, doc){
  if(doc.groupValue !== null) {dArr.push({
        'y': doc.groupValue,
        'a': doc.doclist.numFound
    });}
  });




	Morris.Line({
	  element: 'line-example',
	  data: dArr,

	  xkey: 'y',
	  ykeys: ['a'],
	  labels: ['Series A']
	});





}




</script>


</head>

<body>

<form name="myform">

<input type=text" name="s" id="s" class='textinput'/>

</form>

  <div id="line-example" style="width:1000px"></div>


	<script>

	</script>






<ul id="results">

</ul>

</body>

</html>
